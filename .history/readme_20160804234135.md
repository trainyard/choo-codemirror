# choo-codemirror

How to wrap codemirror with choo

## The Portal

Because codemirror has its own state management system, we need to be careful not to clobber ours.
What we can do is create a portal, this is basically a concept that puts in place strict `message passing`

### lib/codemirror-portal

```javascript
const CodeMirror = require('codemirror')
const defer = fn => setTimeout(fn, 0)
const subscribers = []
const broadcast = type => (...payload) =>
    subscribers.forEach(sub => {
      defer(sub(type, {
        evt: payload,
        doc: payload[0] && payload[0].doc || null,
        change: payload[1] || null
      }))
    })

exports.subscribe = listener => subscribers.push(listener)
exports.create = ({namespace}, options) => {
  const node = document.createElement('div')

  defer(() => {
    const editor = CodeMirror(node, options)
    editor.on('change', broadcast('change'))
    editor.on('focus', broadcast('focus'))
    editor.on('blur', broadcast('blur'))
    editor.on('scroll', broadcast('scroll'))
  })
  return node
}
```

Here we can use `create` to return a new node that asynchronously turns into a codemirror instance,
and `subscribe` which allows us to use a choo `model` to listen to state changes.

## Model

